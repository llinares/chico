/**
  * Chico-UI
  * Packer-o-matic
  * Like the pizza delivery service: "Les than 100 milisecons delivery guarantee!"
  * @components: core, position, positioner, object, floats, navs, , tooltip, dropdown, modal, layer, carousel, tabNavigator
  * @version 0.3
  * @autor Natan Santolo <natan.santolo@mercadolibre.com>
  *
  * based on:
  * @package JSMin
  * @package CssMin
  * @license http://opensource.org/licenses/mit-license.php MIT License
  */
;(function($){

var ui=window.ui={version:"0.4.7",components:"tooltip,dropdown,modal,layer,carousel,tabNavigator",internals:"position,positioner,object,floats,navs",instances:{},init:function(){$("html").removeClass("no-js");ui.components=(window.components)?ui.components+","+window.components:ui.components;ui.internals=(window.internals)?ui.internals+","+window.internals:ui.internals;$(ui.components.split(",")).each(function(i,e){ui.factory({component:e});});},utils:{body:$('body'),html:$('html'),window:$(window),document:$(document),zIndex:1000,index:0}}
ui.factory=function(o){if(!o){alert("Factory fatal error: Need and object {component:\"\"} to configure a component.");return;};if(!o.component){alert("Factory fatal error: No component defined.");return;};var x=o.component;if(!ui.instances[x]){ui.instances[x]=[];}
var create=function(x){$.fn[x]=function(options){var results=[];var that=this;var options=options||{};if(typeof options!=="object"){alert("Factory "+x+" configure error: Need a basic configuration.");return;};that.each(function(i,e){var conf={};conf.name=x;conf.element=e;conf.id=ui.utils.index++;$.extend(conf,options);var created=ui[x](conf);if(created.exists){created=created.object;}else{ui.instances[x].push(created);}
results.push(created);});return(results.length>1)?results:results[0];}
if(o.callback){o.callback();}}
if(ui[o.component]){create(o.component);}else{ui.get({"method":"component","component":o.component,"script":(o.script)?o.script:"src/js/"+o.component+".js","styles":(o.style)?o.style:"src/css/"+x+".css","callback":create});}}
ui.get=function(o){switch(o.method){case"content":var result;var x=o.conf;x.$htmlContent.html('<div class="loading"></div>');$.ajax({url:x.ajaxUrl,type:x.ajaxType||'POST',data:x.ajaxParams,cache:true,async:false,success:function(data,textStatus,xhr){result=data;if(x.callbacks&&x.callbacks.success)x.callbacks.success(data,textStatus,xhr);},error:function(xhr,textStatus,errorThrown){result=(x.callbacks&&x.callbacks.error)?x.callbacks.error(xhr,textStatus,errorThrown):"<p>Error on ajax call</p>";}});return result;break;case"component":if(o.style){var style=document.createElement('link');style.href=o.style;style.rel='stylesheet';style.type='text/css';}
if(o.script){var script=document.createElement("script");script.src=o.script;}
var head=document.getElementsByTagName("head")[0]||document.documentElement;var done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){done=true;if(o.callback){o.callback(o.component);}
script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}}};if(o.script){head.insertBefore(script,head.firstChild);}
if(o.style){head.appendChild(style);}
break;}}
ui.position={center:function(conf){var align=function(){conf.$htmlContent.css({left:(parseInt(ui.utils.window.width())-conf.$htmlContent.outerWidth())/2,top:(ui.utils.html.hasClass('ie6'))?'':(parseInt(ui.utils.window.height())-conf.$htmlContent.outerHeight())/2});};align();ui.utils.window.bind('resize',align);},down:function(conf){var align=function(){conf.$htmlContent.css({top:conf.$wrapper.outerHeight()+10,left:(conf.$wrapper.outerWidth()/2)-20});};align();ui.utils.window.bind('resize',align);},right:function(conf){var align=function(){conf.$htmlContent.css({top:(conf.$wrapper.height()/2)-11,left:conf.$wrapper.outerWidth()+13});};align();ui.utils.window.bind('resize',align);},follow:function(conf){conf.$trigger.bind('mousemove',function(event){conf.$htmlContent.css({top:event.pageY+20,left:event.pageX-32});});}}
ui.positioner=function(o){var element=$(o.element);var context;if(!o.points)o.points="cm cm";if(!o.offset)o.offset="0 0";var classReferences={"lt lb":"down","lb lt":"top","rt rb":"down","rb rt":"top","lt rt":"right"};var splittedOffset=o.offset.split(" ");var offset_left=parseInt(splittedOffset[0]);var offset_top=parseInt(splittedOffset[1]);var getViewport=function(){var viewport;var width;var height;var left;var top;if(typeof window.innerWidth!="undefined"){viewport=window;width=viewport.innerWidth;height=viewport.innerHeight;left=0+offset_left+viewport.pageXOffset;top=0+offset_top+viewport.pageYOffset;bottom=height+viewport.pageYOffset;right=width+viewport.pageXOffset;}else if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!='undefined'&&document.documentElement.clientWidth!=0){viewport=document.documentElement;width=viewport.clientWidth;height=viewport.clientHeight;left=0+offset_left+viewport.scrollLeft;top=0+offset_top+viewport.scrollTop;bottom=height+viewport.scrollTop;right=width+viewport.scrollLeft;}
return{element:viewport,left:left,top:top,bottom:bottom,right:right,width:width,height:height}};var getPosition=function(unitPoints){var xReferences={ll:context.left,lr:context.left+context.width,rr:context.left+context.width-element.outerWidth(),cc:context.left+context.width/2-element.outerWidth()/2}
var yReferences={tt:context.top,tb:context.top+context.height,bt:context.top-element.outerHeight(),mm:context.top+context.height/2-element.outerHeight()/2}
var axis={left:xReferences[unitPoints.my_x+unitPoints.at_x],top:yReferences[unitPoints.my_y+unitPoints.at_y]}
return axis;};var calculatePoints=function(points,unitPoints){var styles=getPosition(unitPoints);styles.direction=classReferences[points];var viewport=getViewport();if((points=="lt lb")&&((styles.top+element.outerHeight())>viewport.bottom)){unitPoints.my_y="b";unitPoints.at_y="t";styles=getPosition(unitPoints);styles.direction="top";styles.top-=context.height;};return styles;};var setPosition=function(points){var splitted=points.split(" ");var unitPoints={my_x:splitted[0].slice(0,1),my_y:splitted[0].slice(1,2),at_x:splitted[1].slice(0,1),at_y:splitted[1].slice(1,2)}
var styles=calculatePoints(points,unitPoints);element.css({left:styles.left,top:styles.top}).removeClass("ch-top ch-left ch-down ch-right").addClass("ch-"+styles.direction);};var initPosition=function(){if(o.context){var contextOffset=o.context.offset();context={element:o.context,top:contextOffset.top+offset_top,left:contextOffset.left+offset_left,width:o.context.outerWidth(),height:o.context.outerHeight()};}else{context=getViewport();};setPosition(o.points);};initPosition();ui.utils.window.bind("resize scroll",initPosition);return $(element);};ui.object=function(){var that=this;return{prevent:function(event){if(event){event.preventDefault();event.stopPropagation();}},loadContent:function(conf){if(conf.ajax&&conf.content){alert('UI: "Ajax" and "Content" can\'t live together.');return;};if(!conf.ajax)return($(conf.content).length>0)?$(conf.content).clone().show():conf.content;if(conf.ajax===true){conf.ajaxUrl=conf.$trigger.attr('href')||conf.$trigger.parents('form').attr('action');conf.ajaxParams='x=x';if(conf.$trigger.attr('type')=='submit'){conf.ajaxType=conf.$trigger.parents('form').attr('method')||'POST';var serialized=conf.$trigger.parents('form').serialize();conf.ajaxParams=conf.ajaxParams+((serialized!='')?'&'+serialized:'');};return ui.get({method:"content",conf:conf})||'<p>Error on ajax call</p>';}else if(conf.ajax.match(/(?:(?:(https?|file):\/\/)([^\/]+)(\/(?:[^\s])+)?)|(\/(?:[^\s])+)/g)){conf.ajaxUrl=conf.ajax;conf.ajaxParams='x=x';return ui.get({method:"content",conf:conf});}else{alert('UI: "Ajax" attribute error.');return;};},callbacks:function(conf,when){if(conf.callbacks&&conf.callbacks[when])conf.callbacks[when](conf);},publish:{}};}
ui.floats=function(){var that=ui.object();var clearTimers=function(){clearTimeout(st);clearTimeout(ht);};var createClose=function(conf){$('<p class="btn close">x</p>').bind('click',function(event){that.hide(event,conf);}).prependTo(conf.$htmlContent);};var createCone=function(conf){$('<div class="cone"></div>').prependTo(conf.$htmlContent);};that.show=function(event,conf){that.prevent(event);if(conf.visible)return;conf.$htmlContent=$('<div class="ch-'+conf.name+'">');conf.$htmlContent.hide().css("z-index",ui.utils.zIndex++).appendTo("body").html(that.loadContent(conf));if(conf.closeButton)createClose(conf);if(conf.cone)createCone(conf);if(conf.classes)conf.$htmlContent.addClass(conf.classes);conf.position.element=conf.$htmlContent;ui.positioner(conf.position);conf.visible=true;conf.$htmlContent.fadeIn('fast',function(){that.callbacks(conf,'show');});};that.hide=function(event,conf){that.prevent(event);if(!conf.visible)return;conf.$htmlContent.fadeOut('fast',function(event){$(this).remove();});conf.visible=false;that.callbacks(conf,'hide');};return that;}
ui.navs=function(){var that=ui.object();that.status=false;that.show=function(event,conf){that.prevent(event);that.status=true;conf.$trigger.addClass('on');conf.$htmlContent.show();that.callbacks(conf,'show');};that.hide=function(event,conf){that.prevent(event);that.status=false;conf.$trigger.removeClass('on');conf.$htmlContent.hide();that.callbacks(conf,'hide');};return that;}
ui.tooltip=function(conf){var that=ui.floats();conf.name='tooltip';conf.cone=true;conf.content=conf.element.title;conf.visible=false;conf.position={context:$(conf.element),offset:"0 10",points:"lt lb"}
conf.publish=that.publish;var show=function(event){$(conf.element).attr('title','');that.show(event,conf);return conf.publish;}
var hide=function(event){$(conf.element).attr('title',conf.content);that.hide(event,conf);return conf.publish;}
var position=function(event){ui.positioner(conf.position);return conf.publish;}
conf.$trigger=$(conf.element).css('cursor','default').bind('mouseenter',show).bind('mouseleave',hide);conf.publish.uid=conf.id,conf.publish.element=conf.element,conf.publish.type="ui.tooltip",conf.publish.content=conf.content,conf.publish.show=function(event){return show(event,conf)},conf.publish.hide=function(event){return hide(event,conf)},conf.publish.position=function(event){return position(event)}
return that.publish;};ui.dropdown=function(conf){var that=ui.navs();$(conf.element).addClass('ch-dropdown');conf.$trigger=$(conf.element).children(':first');conf.$htmlContent=conf.$trigger.next().bind('click',function(event){event.stopPropagation()});conf.publish=that.publish;var show=function(event){that.show(event,conf);return conf.publish;};var hide=function(event){that.hide(event,conf);return conf.publish;};conf.$trigger.bind('click',function(event){if(that.status){that.hide(event,conf);return;};$(ui.instances.dropdown).each(function(i,e){e.hide()});that.show(event,conf);$(document).bind('click',function(event){hide(event);$(document).unbind('click');});}).css('cursor','pointer').addClass('ch-dropdown-trigger').append('<span class="down">&raquo;</span>');conf.$htmlContent.addClass('ch-dropdown-content').css('z-index',ui.utils.zIndex++).find('a').bind('click',function(){hide($.Event())});conf.publish.uid=conf.id,conf.publish.element=conf.element,conf.publish.type="ui.dropdown",conf.publish.show=function(event){return show(event,conf)},conf.publish.hide=function(event){return hide(event,conf)}
return conf.publish;};ui.modal=function(conf){var that=ui.floats();conf.$trigger=$(conf.element);conf.closeButton=true;conf.classes='box';conf.position={fixed:true};conf.publish=that.publish;var show=function(event){dimmer.on();that.show(event,conf);$('.ch-modal .btn.close, .closeModal').bind('click',hide);conf.$trigger.blur();return conf.publish;};var hide=function(event){dimmer.off();that.hide(event,conf);return conf.publish;};var position=function(event){ui.positioner(conf.position);return conf.publish;}
var dimmer={on:function(){$('<div>').bind('click',hide).addClass('ch-dimmer').css({height:$(window).height(),display:'block',zIndex:ui.utils.zIndex++}).hide().appendTo('body').fadeIn();},off:function(){$('div.ch-dimmer').fadeOut('normal',function(){$(this).remove();});}};conf.$trigger.css('cursor','pointer').bind('click',show);conf.publish.uid=conf.id,conf.publish.element=conf.element,conf.publish.type="ui.modal",conf.publish.content=(conf.content)?conf.content:((conf.ajax===true)?(conf.$trigger.attr('href')||conf.$trigger.parents('form').attr('action')):conf.ajax),conf.publish.show=function(event){return show(event)},conf.publish.hide=function(event){return hide(event)},conf.publish.position=function(event){return position(event)}
return conf.publish;};ui.layer=function(conf){var that=ui.floats();conf.$trigger=$(conf.element);conf.cone=true;conf.classes='box';conf.visible=false;conf.position={context:conf.$trigger,offset:"0 10",points:"lt lb"}
conf.publish=that.publish;var show=function(event){that.show(event,conf);if(conf.event==="click"){$('.ch-layer').bind('click',function(event){event.stopPropagation()});$(document).bind('click',function(event){that.hide(event,conf);$(document).unbind('click');});}
return conf.publish;}
var hide=function(event){that.hide(event,conf);return conf.publish;}
var position=function(event){ui.positioner(conf.position);return conf.publish;}
if(conf.event==='click'){conf.closeButton=true;conf.$trigger.css('cursor','pointer').bind('click',show);}else{conf.$trigger.css('cursor','default').bind('mouseover',show).bind('mouseout',hide);};conf.publish.uid=conf.id,conf.publish.element=conf.element,conf.publish.type="ui.layer",conf.publish.content=(conf.content)?conf.content:conf.ajax,conf.publish.show=function(event){return show(event,conf)},conf.publish.hide=function(event){return hide(event,conf)},conf.publish.position=function(event){return position(event)}
return conf.publish;};ui.carousel=function(conf){var that=ui.object();var status=false;conf.$trigger=$(conf.element).addClass('ch-carousel');conf.$htmlContent=$(conf.element).find('.carousel').addClass('ch-carousel-content');conf.publish=that.publish;var htmlElementMargin=($.browser.msie&&$.browser.version=='6.0')?21:20;var htmlContentWidth=conf.$htmlContent.children().size()*(conf.$htmlContent.children().outerWidth()+htmlElementMargin);conf.$htmlContent.wrap($('<div>').addClass('mask')).css('width',htmlContentWidth);var $mask=conf.$trigger.find('.mask');var steps=~~((conf.$trigger.width()-70)/(conf.$htmlContent.children().outerWidth()+20));steps=(steps==0)?1:steps;var moveTo=(conf.$htmlContent.children().outerWidth()+20)*steps;var margin=($mask.width()-moveTo)/2;$mask.width(moveTo).height(conf.$htmlContent.children().outerHeight());if(conf.arrows!=false)$mask.css('marginLeft',margin);var prev=function(event){if(status)return;var htmlContentPosition=conf.$htmlContent.position();status=true;conf.$htmlContent.animate({left:htmlContentPosition.left+moveTo},function(){htmlContentPosition=conf.$htmlContent.position();if(htmlContentPosition.left>=0)prevButton.hide();nextButton.show();status=false;});return conf.publish;}
if($.browser.msie&&$.browser.version=='6.0')htmlContentWidth=htmlContentWidth-(conf.$htmlContent.children().outerWidth()*2);var next=function(event){if(status)return;var htmlContentPosition=conf.$htmlContent.position();status=true;conf.$htmlContent.animate({left:htmlContentPosition.left-moveTo},function(){htmlContentPosition=conf.$htmlContent.position();if(htmlContentPosition.left+htmlContentWidth<=$mask.width())nextButton.hide();prevButton.show();status=false;});return conf.publish;}
var prevButton=$('<p>').html('Previous').addClass('prev').bind('click',prev).hide().css('top',(conf.$htmlContent.children().outerHeight()-57)/2+10);var nextButton=$('<p>').html('Next').addClass('next').bind('click',next).hide().css('top',(conf.$htmlContent.children().outerHeight()-57)/2+10);if(conf.arrows!=false){conf.$trigger.prepend(prevButton).append(nextButton);if(htmlContentWidth>$mask.width()){nextButton.show();}}
conf.publish.uid=conf.id;conf.publish.element=conf.element;conf.publish.type="ui.carousel";conf.publish.next=function(){return next($.Event());};conf.publish.prev=function(){return prev($.Event());};return conf.publish;}
ui.tabNavigator=function(conf){var that=ui.controllers();conf.publish=that.publish;var $triggers=$(conf.element).children(':first').find('a');var $htmlContent=$(conf.element).children(':first').next();$(conf.element).addClass('ch-tabNavigator');$(conf.element).children(':first').addClass('ch-tabNavigator-triggers');$triggers.addClass('ch-tabNavigator-trigger');$htmlContent.addClass('ch-tabNavigator-content box');$.each($triggers,function(i,e){that.children.push(ui.tab(i,e,conf));});var show=function(event,tab){that.children[tab].shoot(event);return conf.publish;};conf.publish.uid=conf.id,conf.publish.element=conf.element,conf.publish.type="ui.tabNavigator",conf.publish.tabs=that.children,conf.publish.select=function(tab){return show($.Event(),tab)}
return conf.publish;};ui.tab=function(index,element,conf){var that=ui.navs();var display=element.href.split('#');var $tabContent=$(element).parents('.ch-tabNavigator').find('#'+display[1]);that.conf={name:'tab',$trigger:$(element).addClass('ch-tabNavigator-trigger'),callbacks:conf.callbacks};var results=function(){if($tabContent.attr('id')){return $tabContent;}else{that.conf.ajax=true;var w=$('<div>').attr('id','ch-tab'+index);w.hide().appendTo(that.conf.$trigger.parents('.ch-tabNavigator').find('.ch-tabNavigator-content'));return w;};};that.conf.$htmlContent=results();if(index==0){that.status=true;that.conf.$trigger.addClass('on');};if(!that.status)that.conf.$htmlContent.hide();that.shoot=function(event){that.prevent(event);var tabs=conf.publish.tabs;if(tabs[index].status)return;$.each(tabs,function(i,e){if(e.status)e.hide(event,e.conf);});if(that.conf.$htmlContent.html()==='')that.conf.$htmlContent.html(that.loadContent(that.conf));that.show(event,that.conf);};that.conf.$trigger.bind('click',that.shoot);return that;}
ui.init();
})(jQuery);